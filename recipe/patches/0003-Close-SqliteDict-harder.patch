From 479626197a5369921b6125277460eb27c58d391d Mon Sep 17 00:00:00 2001
From: Dirk Groeneveld <dirkg@allenai.org>
Date: Fri, 11 Feb 2022 13:22:50 -0800
Subject: [PATCH 3/3] Close SqliteDict harder

---
 tango/common/sqlite_sparse_sequence.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/tango/common/sqlite_sparse_sequence.py b/tango/common/sqlite_sparse_sequence.py
index 5132cf4..6801039 100644
--- a/tango/common/sqlite_sparse_sequence.py
+++ b/tango/common/sqlite_sparse_sequence.py
@@ -13,7 +13,9 @@ class SqliteSparseSequence(MutableSequence[Any]):
         self.table = SqliteDict(filename, "sparse_sequence", flag="r" if read_only else "c")
 
     def __del__(self):
-        self.close()
+        if self.table is not None:
+            self.table.close(force=True)
+            self.table = None
 
     def __getitem__(self, i: Union[int, slice]) -> Any:
         if isinstance(i, int):
-- 
2.32.0.windows.2

